<!DOCTYPE html>
<html>
<body>

<form id="form" action = "/welcome" method = "POST">
    Email: <input type = "email" name = "mail" required> <br>
    Password: <input type = "password" name = "password" required>
    <input type = "submit" value = "Connection">
</form>
<form method="GET" action="/inscription">
    <input type="submit" value="Inscription">
</form>
</body>
</html>

<!-- let pool = new pg.Pool({
	user: 'postgres',
	host: '127.0.0.1',
	database: 'postgres',
	password: 'sql',
	port: '5432'
});
pool.connect(function(err) {
	if (err) throw err;
	console.log("Connected!");
});

//permet d'ajouter des utilisateurs dans la base de données
function insert(answer) {
	let values = Object.values(answer);
	let notif = false;
	if (values[4] === 'yes'){
		notif = true;
	}
	let sql = "INSERT INTO users (firstname, lastname, mail, password, notifications) VALUES ('"+ values[0] + "','" + values[1] + "','" +values[2] + "','" + values[3] + "'," + notif + ')';
	pool.query(sql, (err) => {
		if (err) throw err;
	});
	pool.end();
};

//Selectionner certaines données dans la base de données
async function select(columns, table, condition) {
	let sql;
	if(condition !== ''){
		sql = "SELECT "+ columns + " FROM "+ table + " WHERE " + condition;
	}
	else {
		sql = "SELECT " + columns + " FROM " + table;
	}
	await pool.query(sql, (err, res) =>{
		if(err) throw err;
		return res;
	});
}
async function login(mail, pwd){
	let userRecord = await select('*', 'users', 'mail = \''+mail + '\'');
	if (!userRecord){
		console.log('User not found');
		return null;
	}
	else{
		let pwdCheck = await argon2.verify(userRecord.password, pwd);
		if (!pwdCheck){
			console.log('Verify password');
			return null;
		}
	}
	return userRecord;
}

/*app.post('/', (req, res) =>{
	let response = null;
	response = {
		mail:req.body.mail,
		password:req.body.pwd1,
	};
	console.log(response);
	select('mail, password', 'users', 'mail LIKE \''+ response.mail +'%\'');
	setTimeout(() =>{
		if (sel.length > 0){
			for (let i = 0; i < sel.length; i++) {
				if (sel[i].password === response.password){
					console.log('Password ok ', sel[i].password, response.password);
					res.sendFile(__dirname+'/home.html');
				}
				else {
					console.log('Password KO ', sel[i].password, response.password);
					res.sendFile( __dirname+'/connect.html', '<script>alert(\'Mauvais mot de passe\')</script>' );
				}
			}
		}
		else {
			res.sendFile(__dirname+'/inscription.html')
		}
	}, 500);
});
*/

app.get('/', (req, res) =>{
	res.sendFile(__dirname+'/home.html');
});

app.get('/inscription.html', (req, res) =>{
	res.sendFile(__dirname + "/inscription.html");
});

app.get('/connect.html', (req, res)=>{
	res.sendFile(__dirname+ '/connect.html');
});

app.post('/login', (err, res, next) => {
	let fields = form.parse(fields =>{ return fields});
	let log = login(fields.mail, fields.pwd1);
	if (log === null){
		res.sendFile(__dirname + '/connect.html');
	}
	else{
		res.sendFile(__dirname + '/home.html');
	}
});-->